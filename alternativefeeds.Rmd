---
title: "Alternative aquafeeds"
author: "Richard Cottrell"
date: "11 May 2018"
output: word_document
---

```{r}
library(plyr)
library(dplyr)
library(tidyr)
library(ggplot2)

```

#IMPORT AND TIDY AQUACULTURE DATA

```{r cars}

aqua.raw<-read.csv("aquaculture-prod-raw.csv", header=T)
summary(aqua.raw)
names(aqua.raw)[names(aqua.raw)=="Country..Country."]<-"Country"
names(aqua.raw)[names(aqua.raw)=="Species..ASFIS.species."]<-"Species"
names(aqua.raw)[names(aqua.raw)=="Aquaculture.area..FAO.major.fishing.area."]<-"Area"
names(aqua.raw)[names(aqua.raw)=="Environment..Environment."]<-"Environment"

aqua.raw2<-aqua.raw %>% gather(Year, Value, -c(Country, Species, Area, Environment, Unit))
head(aqua.raw2)
levels(aqua.raw2$Unit)

aqua.raw2$Year<-gsub("X", "", aqua.raw2$Year)
aqua.raw2$Year<-as.numeric(aqua.raw2$Year)

#Sort the symbols in values out
## "..." = data unavailable
## " " = data not separately available
## "-" = nil or zero
## "0 0" = more than zero but less than half the unit used
## F = FAO estimate from available sources of information
aqua.raw2$Value[aqua.raw2$Value=="0 0"] <- 0.5
aqua.raw2$Value[aqua.raw2$Value=="-"] <- 0

#exclude unavailable data
aqua.raw2 <- aqua.raw2[aqua.raw2$Value!="...",]
aqua.raw2 <- aqua.raw2[aqua.raw2$Value!="",]

#Use estimates as data
aqua.raw2$Value <- gsub(' F', '', aqua.raw2$Value)
head(aqua.raw2)
aqua.raw2$Value <- as.numeric(aqua.raw2$Value)

prod.aqua<-aqua.raw2
prod.aqua

#get taxons
taxons<-read.csv("CL_FI_SPECIES_GROUPS.csv", header = T)

names(taxons)[names(taxons)=="Name_en"]<-"Species"
prod.aqua<-join(prod.aqua, taxons, by="Species", type="inner")

#Exclude totals and weird country values
levels(prod.aqua$Country)
prod.aqua<- prod.aqua[prod.aqua$Country!="FAO. 2017. Fishery and Aquaculture Statistics. Global aquaculture production 1950-2015 (FishstatJ). In: FAO Fisheries and Aquaculture Department [online]. Rome. Updated 2017. www.fao.org/fishery/statistics/software/fishstatj/en",]
prod.aqua<- prod.aqua[prod.aqua$Country!="Totals",]

write.csv(prod.aqua, "Aquaculture production tidy.csv", row.names = F)

```

## Plotting changes in production over time of species groups and projections based on IMPACT model projections

```{r}

aqua<-read.csv("Aquaculture production tidy.csv", header = T)
diets<-read.csv("fishmeal diet data.csv", header = T)
taxons<-read.csv("CL_FI_SPECIES_GROUPS.csv", header = T)
names(taxons)[names(taxons)=="Name_en"]<-"Species"

diets<-join(diets, taxons, by="Species", type="left")

aqua.fed<-join(aqua, diets, by="Species", type="left")
#aqua.fed<-aqua.fed[!is.na(aqua.fed$IMPACT_species),]

#exclude non-fed and amphib/reptile species
aqua.fed<-aqua.fed[aqua.fed$Major_Group=="CRUSTACEA" | aqua.fed$Major_Group=="PISCES",]
aqua.fed$IMPACT_species<-as.character(aqua.fed$IMPACT_species)

aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Carps, barbels and other cyprinids"]<-"Carp"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Cods, hakes, haddocks"]<-"Major demersal"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Crabs, sea-spiders"]<-"Crustaceans"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Flounders, halibuts, soles"]<-"Major demersal" #check
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Freshwater crustaceans"]<-"Crustaceans"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Lobsters, spiny-rock lobsters"]<-"Crustaceans"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Marine fishes not identified"]<-"Other marine"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous coastal fishes"]<-"Other marine"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous demersal fishes"]<-"Other marine"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous diadromous fishes"]<-"Other freshwater"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous freshwater fishes"]<-"Other freshwater"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous marine crustaceans"]<-"Crustaceans"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Miscellaneous pelagic fishes"]<-"Other pelagic"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="River eels"]<-"Eels and Sturgeon"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Salmons, trouts, smelts"]<-"Salmon"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Shads"]<-"Other Marine"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Shrimps, prawns"]<-"Shrimp"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Sturgeons, paddlefishes"]<-"Eels and Sturgeon"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Tilapias and other cichlids"]<-"Tilapia"
aqua.fed$IMPACT_species[aqua.fed$ISSCAAP_Group=="Tunas, bonitos, billfishes"]<-"Tuna"

aqua.fed$IMPACT_species<-as.factor(aqua.fed$IMPACT_species)

#need to exclude silver and bighead carp


aqua.fed.global<-aggregate(aqua.fed$Value~aqua.fed$Year+aqua.fed$IMPACT_species,FUN=sum)

names(aqua.fed.global)[1]<-"Year"
names(aqua.fed.global)[2]<-"Group"
names(aqua.fed.global)[3]<-"Value"


#relevel the group factor
levels(aqua.fed.global$Group)
aqua.fed.global$Group<-factor(aqua.fed.global$Group, levels(aqua.fed.global$Group)[c(1,10,9,11)])


#Look at the ISCAAP production data
ggplot(data = aqua.fed.global, aes(x=Year, y=Value, colour=Group))+geom_line()
ggsave("fishsummary.tiff", device = "tiff", dpi=600, width = 10, height = 6)

ordered<-aqua.fed.global[aqua.fed.global$Year==2015,]
ordered<-ordered[order(-ordered$Value),]

cols<-

ggplot(data = aqua.fed.global[,c(1,3,4)], aes(x=Year, y=Value, colour=IMPACT_species))+geom_line()

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
